<project basedir="." name="Elastic Memory" default="jar">
    
	<property name="version" value="1.9.5-SNAPSHOT"/>
    <property name="workspace.dir" value="/java/workspace"/>
    <property name="elastic.dir" value="${workspace.dir}/elastic-memory/trunk"/>
    <property name="hazelcast.dir" value="${workspace.dir}/hazelcast/trunk/hazelcast"/>
	<property name="hazelcast.resource.dir" value="${hazelcast.dir}/src/main/resources"/>
	<property name="classes.dir" value="target/classes"/>
    <property name="jar.name" value="hazelcast-enterprise-${version}.jar"/>
	<property name="jar.file" value="${elastic.dir}/target/${jar.name}"/>

    <target name="jar">
    	<delete>
			<fileset dir="${elastic.dir}/target">
			    <include name="*.jar"/>
			</fileset>
		</delete>
    	
    	<zip destfile="${jar.file}">
            <zipfileset dir="${hazelcast.dir}/${classes.dir}">
            	<exclude name="**/META-INF/services/*"/>
            </zipfileset>
    		<zipfileset dir="${hazelcast.resource.dir}" >
    			<include name="**/META-INF/*"/>
    			<exclude name="**/META-INF/services/*"/>
    		</zipfileset>
            <zipfileset dir="${elastic.dir}/${classes.dir}"/>
    	</zip>
    </target>
	
	<target name="clean">
		<delete includeemptydirs="true" failonerror="no">
			<fileset dir="${basedir}/root">
			</fileset>
		</delete>
	</target>
	
	<target name="merge">
		<mkdir dir="${basedir}/root" />
		<copy todir="${basedir}/root">
			<fileset dir="${workspace.dir}/hazelcast/trunk">
				<exclude name="**/target/**/*"/>
    			<exclude name="**/META-INF/services/*"/>
			</fileset>
		</copy>
		
		<copy todir="${basedir}/root/hazelcast/src">
			<fileset dir="${elastic.dir}/src">
				<exclude name="**/test/**/*"/>
			</fileset>
		</copy>
		<copy todir="${basedir}/root/hazelcast-client/src">
			<fileset dir="${elastic.dir}/src">
				<include name="**/test/**/*"/>
			</fileset>
		</copy>
		<copy todir="${basedir}/root">
			<fileset dir="${basedir}">
				<include name="release.sh" />
			</fileset>
		</copy>
	</target>
	
	<target name="rm-license">
		<delete>
			<fileset dir="${basedir}/root">
			    <include name="**/*.license"/>
			</fileset>
		</delete>
	</target>
		
	<target name="release" depends="rm-license">
		<exec dir="${basedir}/root" executable="mvn">
			<arg value="clean" />
			<arg value="package" />
			<arg value="resources:resources"/>
			<arg value="assembly:assembly" />
			<arg value="-DskipTests" />
		</exec>
	</target>
	
	<target name="release.sh" depends="rm-license">
		<exec dir="${basedir}/root" executable="sh">
			<arg value="release.sh" />
		</exec>
	</target>	
</project>
